<h1>Edge Cases and Electricity</h1>
<p>Only half of an engineer's work is readily apparent to the consumer. This because testing requires just as much effort and enginuity as the process of design but unfortunately it is felt only when it falls short. Incidentally this is also why QA is less likely to recieve as much resources as development in the real world</p>
<p>So you aspiring Rust combat engineer may be asking, why do I care? Well it turns out the Nih core has an unaccounted edge case. What is an "edge case"? Well in testing lingo an "edge case" is an atypical scenario that may cause uintended behavior. Specificly talking about the Nih core, the edge case concerns the failure speed of the generators, fast vs slow</p>
<h2>Problem: Batteries are Inefficient</h2>
<p>First a bit of background on why one would use the Nih core or any power distributor circuit. Batteries in Rust all charge at 80% efficiency, which means if you charge 100 units of power into a battery, 20 of it is just lost (also the reason why daisy chaining batteries is a bad idea)</p>
<div><img src="/img/gone.png"/></div>
<p>This means more windmills, more attention from raiders, more serial points of failure during a raid. Oh hell no! So enter the Nih core, how it works is that you calculate beforehand how much power your devices will collectively need and it will try to power your devices directly from the power source while it charges your batteries with the excess, switching to your batteries only when the generators fall short. Thus ensureing you only take the penalty on power that would go unused anyways. So, behold, your standard Nih core</p>
<div><img src="/img/nih.jpg" /></div>
<h2>Problem: Fast vs Slow failure</h2>
<p>Prevaling wisdom is that 1 windmill to 1 large battery is all you need, while this is largely true, the power curve of a turbine is actually not guaranteed to remain above 100. So a Nih core will fail over to the battery at least once a day. During this failure, the power going to the splitter will drop from 3 to 0. However the speed in which this happens results in something unexpected</p>
<h2>The fast case</h2>
<p>In a fast failure, the input degrades from 3 to 0 instantly. Although to the human eye all 3 outputs seem to lose power simultaneously, to the game, output 1 loses power first, followed by 2, then 3. Nih core uses this fact by splitting the first 3 excess power from the generators and connecting the splitter's terminals 1 and 2 to a memory cell's set and reset terminals, respectively (lets ignore the third output going to a blocker for now). Everything works fine in this case, ensuring the system instantly fails over to battery power when the generator can not directly power the load</p>
<h2>The slow case</h2>
<p>In a slow failure, the input degrades from 3 to 0 one power at a time. The first terminal to lose power is always output 3, then 2, and finally 1. When the power recovers to 3 the opposite happens. Here the Nih core will incorrectly stay in passthrough mode because terminal 1, which is connected to the set terminal of the memory cell, is always the last to lose power. This results in all the power generated in the mean time to be incorrectly sent to the or gate instead of the battery, where it is promptly lost. Note that this does not cause a brown out because the battery has already begun draining as soon as the blocker disengaged, which too impacts system efficiency. So if you were ever wondering why your setup doesn't seem to be that much more efficient, these two factors are probably the culprit</p>
<p>Note that the solution can not be to swap the connections of the set and reset terminals, as this would lead to the same problem during fast degradation</p>
<h2>The Solution</h2>
<p>One way to address the problem is by adding a regulating electrical branch on the battery side, setting it to branch the same amount of power as the input branch (to which the generators are connected). Then connecting its remaining power out terminal to the reset terminal of the memory cell. This allows the battery to always switch the memory cell in failover mode as well as removing the need to have the blocker in its entirety</p>
<div><img src="/img/distributor.jpg" /></div>
